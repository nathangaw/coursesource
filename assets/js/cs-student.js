(()=>{var e,o;(e=jQuery)(document).ready((function(){var n=e("#myCourseDataContainer"),t=e("#myCoursesTable").attr("data-nonce");function a(o){window.history.pushState({},"","#"+o),e.ajax({url:CoursesourceFrontend.ajaxurl,method:"POST",data:{action:"cs_course_table_details",enrolment_id:o,nonce:t}}).done((function(o){""==o||0==o?n.html("Course lesson data could not be found."):n.html(o),e("html,body").animate({scrollTop:n.offset().top},"slow")}))}o=new HystModal({afterClose:function(){window.history.pushState({},"","#")}}),e(".openEnrolment").on("click",(function(o){a(e(this).attr("data-enrolment_id"))})),e("#addEnrolmentKey").click((function(n){e("#modalWindowContents").html('<h2>Add Enrolment via Key</h2>\t\t\t<p>If you have been sent an enrolment key, enter it below to use it and add the course to your profile.</p>\t\t\t<form id="addEnrolmentForm"><input type="text" id="enrolmentKeyInput" name="key" value=""/><span class="button alt" id="submitEnrolmentForm">Submit</span></form><div id="enrolmentFeedback"></div>'),o.open("#modalWindow")})),e("#modalWindowContents").on("click","#submitEnrolmentForm",(function(o){o.preventDefault();var n=e("#enrolmentFeedback");n.removeClass("alert error success").text("").hide(),e.ajax({url:CoursesourceFrontend.ajaxurl,method:"POST",data:{action:"course_enrole_from_key",key:e("#enrolmentKeyInput").val(),nonce:t}}).done((function(e){e.success?(n.addClass("alert success").show().text("Enrolment successful, reloading page."),window.location.reload()):e.error&&n.addClass("alert error").show().text(e.error.join("\n"))}))})),e("#myCourseDataContainer").on("click",".tutorialOpen",(function(o){o.preventDefault();var n=e(o.target).attr("data-lesson-url"),t=window.location.href;-1!==(t=t.replace(/\#/g,"")).indexOf("?")?t+="&coursesource_action=closeCourseWindow":t+="?coursesource_action=closeCourseWindow",e("#cs_overlay").html('<iframe class="cs_iframe" marginwidth="0" margin="0" height="0" scrolling="no" src="'+n+"&returnURL="+t+'"></iframe><span class="cs_iframe-close">x</span>'),e("#cs_overlay").show()})),e("#cs_overlay").on("click",".cs_iframe-close",(function(o){e("#cs_overlay").hide(),e("#cs_overlay").html("")})),parseInt(window.location.hash.replace("#",""))>0&&a(parseInt(window.location.hash.replace("#",""))),window.onhashchange=()=>{parseInt(window.location.hash.replace("#",""))>0&&a(parseInt(window.location.hash.replace("#","")))}}))})();