(()=>{var e,t,o,r,s,a;e=jQuery,t=CoursesourceListTable.import_courses_nonce,o=CoursesourceListTable.thickbox_id,r=!1,s=function(t){return e('<div style="padding: 3rem; text-align: center;"><p>'+t+'</p><p style="margin-top: 2rem;text-align: center"><img src="/wp-includes/images/spinner-2x.gif" alt="" /></p></div>')},a=function(o){if(!0!==r){var i=o.processed;course_id=o.courses[i].CourseID;var n=[course_id];e.ajax({url:CoursesourceListTable.ajaxurl,method:"POST",data:{action:"cs_course_import",course_id:n,nonce:t}}).done((function(t){o.processed++,t.success?o.coursesUpdated.push(course_id):o.coursesFailed.push(course_id),thickBoxContent=s("Processed "+o.processed+" of "+o.courses.length+" Courses.<br/>Completed: "+o.coursesUpdated.length+", Failed: "+o.coursesFailed.length),e("#TB_ajaxContent").html(thickBoxContent),o.processed==o.courses.length&&e("body").trigger("coursesource-thickbox-close"),a(o)}))}},e(document).ready((function(){e("#select_vendor").on("change",(function(){e("#search-submit").trigger("click")})),e(".coursetitle").click((function(r){r.preventDefault();var a=e(this),i=a.attr("data-course-id"),n=a.text();e("#"+o).html(s("Processing..")),e("body").addClass("cs-course-details"),tb_show("Course Details: "+n,"#TB_inline?&width=600&height=550&inlineId="+o),e.ajax({url:CoursesourceListTable.ajaxurl,method:"POST",data:{action:"cs_course_details",course_id:i,nonce:t}}).done((function(t){var o=t.course,r="";t.course?r=e('<table class="csTable horizontal">                        <tr><th>Title</th><td>'+o.CourseInfo.Course_Title+"</td></tr>                        "+(null!=o.CourseInfo.Hours_of_Training?"<tr><th>Length</th><td>"+o.CourseInfo.Hours_of_Training+"</td></tr>":"")+"                        <tr><th>Price</th><td>"+o.BuyPriceCurrency+o.BuyPrice+'</td></tr>                        <tr><td colspan="2">'+o.Outline.Introduction+"</td></tr>                    </table>"):(r=e("<div><p>Error loading the Course content</p></div>"),console.log("Reason for failure...")),e("#TB_ajaxContent").html(r)}))})),e(".import_course").on("click",(function(o){o.preventDefault();var r=e(this),s=r.text(),a=r.attr("data-course_id"),i=parseInt(r.attr("data-course-imported"));if(!r.attr("data-loading")){r.text("Saving, please wait..."),r.attr("data-loading",!0);var n=[a];e.ajax({url:CoursesourceListTable.ajaxurl,method:"POST",data:{action:"cs_course_import",course_id:n,nonce:t}}).done((function(t){if(console.log(t),t.success){if(r.text(s),r.removeAttr("data-loading"),1!==i){var o=(a=r,n=t.success,c=CoursesourceListTable.adminurl+"post.php?post="+n+"&amp;action=edit",u=a.attr("data-course_id"),e("<a href='"+c+"'class='action_view view_course button' data-course_id='"+u+"'>Edit Product</a>"));r.before(o)}}else t.error?alert(t.error):alert("Import failed! Please try again in a moment");var a,n,c,u;e(r).text("Resynchronise"),e(this).removeAttr("data-loading")}))}})),e("#cs-courses-table-sync__selected").on("click",(function(r){r.preventDefault();var a=e(this);a.text("Processing..."),e("#"+o).html(s("Importing Courses...")),tb_show("Importing Courses...","#TB_inline?&width=600&height=340&inlineId="+o);var i=a.text(),n=[];e('input[name="courses[]"]:checked').each((function(){var t=e(this).val();n.push(t)})),e.ajax({url:CoursesourceListTable.ajaxurl,method:"POST",data:{action:"cs_course_import",course_id:n,nonce:t}}).done((function(e){e.success?(a.text(i),location.reload()):e.error?alert(e.error):alert("Import failed! Please try again in a moment")}))})),e("#cs-courses-table-sync__entire_library").on("click",(function(r){if(r.preventDefault(),!confirm("Are you sure? This will take some time, and overwrite any products that have been changed, and disable all products beginning with the CourseSource SKU prefix that aren't found in the library"))return!1;e("#cs-courses-table-sync-spinner").html('Loading courses into memory... <img src="/wp-admin/images/spinner.gif" />'),e("#"+o).html(s("Loading all Courses. Please be patient...")),tb_show("Importing all Courses...","#TB_inline?&width=400&height=260&inlineId="+o),e.ajax({url:CoursesourceListTable.ajaxurl,method:"POST",data:{action:"get_course_library",get_course_library:1,nonce:t}}).done((function(t){var o="";if(t.courses){var r=t.courses,i={processed:0,courses:r,coursesUpdated:[],coursesFailed:[]};o=s("Found "+r.length+" Courses"),e("#TB_ajaxContent").html(o),a(i)}else o=e("<div><p>Error loading the Course Library</p></div>"),e("#TB_ajaxContent").html(o),console.log("Reason for failure...")}))})),e("body.product_page_course-source-import").on("thickbox:removed",(function(e){r=!0;let t=e.target;t.classList.contains("cs-course-details")?t.classList.remove("cs-course-details"):(alert("Stopping importing Courses"),location.reload())})),e("body.product_page_course-source-import").on("coursesource-thickbox-close",(function(e){alert("All Courses imported"),location.reload()}))}))})();